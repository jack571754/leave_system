# 🎯 审批流程管理系统 - 完整功能清单

## 🌐 访问入口

| 页面 | 地址 | 说明 |
|------|------|------|
| 首页 | http://localhost:8000/ | 自动跳转到管理面板 |
| 管理面板 | http://localhost:8000/dashboard/ | 主要管理界面 |
| BPMN 设计器 | http://localhost:8000/bpmn-designer/ | 可视化流程设计器 |
| API 文档 | http://localhost:8000/api/ | REST API 接口 |
| 管理后台 | http://localhost:8000/admin/ | Django 管理后台 |

---

## 📊 管理面板功能（8个标签页）

### 1. 📝 创建申请
- ✅ 请假申请
  - 支持多种请假类型（年假、病假、事假等）
  - 设置请假时长和日期
  - 自动计算天数
- ✅ 密码修改申请
  - 选择密码类型（普通/重要/关键）
  - 选择用户级别（普通/管理员/超级管理员）
  - 指定系统名称
- ✅ 表单自动切换
- ✅ 实时验证
- ✅ 提交反馈

### 2. 📋 我的申请
- ✅ 输入邮箱查询个人申请
- ✅ 显示申请列表
  - 申请ID
  - 类型
  - 原因
  - 状态（待审批/已批准/已拒绝）
  - 创建时间
- ✅ 查看审批历史
- ✅ 状态徽章显示

### 3. ⏳ 待审批
- ✅ 输入审批人邮箱查询
- ✅ 显示待审批任务列表
  - 任务名称
  - 申请人信息
  - 部门
  - 申请原因
- ✅ 一键审批
  - 批准
  - 拒绝
  - 添加审批意见
- ✅ 审批模态框

### 4. 📊 所有申请
- ✅ 查看系统所有申请
- ✅ 管理员功能
- ✅ 数据统计

### 5. 🎨 BPMN 配置
- ✅ 流程列表展示
- ✅ 流程详情查看
- ✅ 流程文件管理
- ✅ 流程操作
  - 验证流程
  - 部署流程
  - 删除流程
- ✅ 创建新流程
- ✅ **打开 BPMN 设计器**（新增）

### 6. 🔌 API 接口
- ✅ 完整 API 文档
- ✅ 请求示例
- ✅ 响应格式说明
- ✅ 接口分类
  - 申请管理
  - 审批操作
  - 历史记录

### 7. ⚙️ 流程说明
- ✅ 流程模型目录结构
- ✅ BPMN 文件说明
- ✅ 表单 Schema 说明
- ✅ 审批流程图示
  - 请假审批流程
  - 密码修改审批流程
- ✅ 配置文件格式

### 8. 📚 文档
- ✅ 快速开始指南
- ✅ 配置教程
- ✅ API 文档链接
- ✅ 测试账号列表
- ✅ 使用提示
- ✅ 自动化测试说明

---

## 🎨 BPMN 设计器功能

### 核心功能
- ✅ **可视化流程设计**
  - 基于 bpmn-js 的专业建模器
  - 拖拽式设计界面
  - 实时预览

- ✅ **智能属性面板**
  - 深色主题界面
  - 根据元素类型动态显示
  - 实时属性编辑

- ✅ **代码编辑器（CodeMirror）**
  - 语法高亮（Python、XML、JavaScript）
  - 行号显示
  - 自动补全
  - 括号匹配
  - Monokai 主题

### 元素支持
- ✅ 开始事件 (Start Event)
- ✅ 结束事件 (End Event)
- ✅ 用户任务 (User Task)
  - 表单配置
  - 前置脚本
  - 后置脚本
- ✅ 脚本任务 (Script Task)
  - Python 脚本编辑
- ✅ 排他网关 (Exclusive Gateway)
- ✅ 并行网关 (Parallel Gateway)
- ✅ 连接线 (Sequence Flow)
  - 条件表达式

### 工具栏功能
- ✅ 新建流程
- ✅ 打开文件
- ✅ 保存流程
- ✅ 下载 BPMN
- ✅ 导出 SVG
- ✅ 放大/缩小
- ✅ 适应画布
- ✅ 撤销/重做

### 属性编辑
- ✅ 基本属性（ID、名称）
- ✅ 表单配置（JSON Schema）
- ✅ 前置脚本（Python）
- ✅ 后置脚本（Python）
- ✅ 脚本内容（Python）
- ✅ 条件表达式（Python）
- ✅ 网关配置

---

## 🔌 API 接口

### 申请管理
- `POST /api/leave/create/` - 创建申请
- `GET /api/leave/my-requests/` - 我的申请
- `GET /api/leave/pending-approvals/` - 待审批任务

### 审批操作
- `POST /api/leave/approve/` - 批准申请
- `POST /api/leave/reject/` - 拒绝申请
- `POST /api/leave/return/` - 退回申请

### 历史记录
- `GET /api/leave/requests/{id}/history/` - 审批历史
- `GET /api/leave/requests/{id}/timeline/` - 审批轨迹

### BPMN 管理
- `GET /api/bpmn/processes/` - 流程列表
- `GET /api/bpmn/processes/{id}/` - 流程详情
- `POST /api/bpmn/processes/` - 创建流程
- `DELETE /api/bpmn/processes/{id}/` - 删除流程
- `GET /api/bpmn/processes/{id}/validate/` - 验证流程
- `POST /api/bpmn/processes/{id}/deploy/` - 部署流程

---

## 📋 审批流程

### 请假审批流程
```
申请人 → 部门主管 → 完成
```
- 短期请假（≤24小时）
- 长期请假（>24小时）
- 支持超时提醒

### 密码修改审批流程

**普通密码 + 普通用户**
```
申请人 → 部门主管 → 完成
```

**重要密码 + 普通用户**
```
申请人 → 部门主管 → IT安全主管 → 完成
```

**关键密码 或 管理员**
```
申请人 → 部门主管 → IT安全主管 → 系统管理员 → 完成
```

---

## 🎯 技术特性

### 前端
- ✅ 原生 HTML/CSS/JavaScript
- ✅ 响应式设计
- ✅ 现代化 UI
- ✅ bpmn-js 集成
- ✅ CodeMirror 集成

### 后端
- ✅ Django 4.2.9
- ✅ Django REST Framework
- ✅ SpiffWorkflow 工作流引擎
- ✅ SQLite 数据库

### 工作流
- ✅ BPMN 2.0 标准
- ✅ 多级审批
- ✅ 条件路由
- ✅ 并行审批
- ✅ 脚本任务
- ✅ 状态持久化

---

## 📦 项目文件

### 核心文件
- `leave_system/templates/dashboard.html` - 管理面板
- `leave_system/templates/bpmn_designer.html` - BPMN 设计器
- `leave_system/leave_api/` - 核心 API
- `process_models/` - BPMN 流程定义

### 文档文件
- `README.md` - 项目说明
- `访问指南.md` - 使用指南
- `BPMN设计器使用指南.md` - 设计器教程
- `密码修改审批流程配置教程.md` - 配置教程
- `功能更新说明.md` - 更新日志
- `完整功能清单.md` - 本文档

### 测试文件
- `test_password_change.py` - 自动化测试脚本
- `验证服务.py` - 服务验证脚本

---

## 🚀 快速开始

### 1. 启动服务
```bash
cd leave_system
python manage.py runserver 0.0.0.0:8000
```

### 2. 访问系统
浏览器打开：http://localhost:8000/

### 3. 使用功能
- 创建申请
- 审批任务
- 设计流程

---

## 💡 使用建议

1. **新用户**：从管理面板开始，熟悉基本功能
2. **流程设计**：使用 BPMN 设计器创建自定义流程
3. **测试验证**：运行自动化测试脚本验证功能
4. **查看文档**：遇到问题查看相关文档

---

## 📞 技术支持

- 📖 查看文档标签页
- 🔌 查看 API 接口标签页
- 📚 查看项目根目录下的 Markdown 文档

---

**系统版本**: v2.0  
**更新时间**: 2026-01-18  
**功能状态**: ✅ 全部完成
