# 密码修改审批流程配置教程

## 概述

本教程将指导你配置一个完整的密码修改审批流程，支持：
- **多级审批**：部门主管 → IT安全主管 → 系统管理员
- **多分支审批**：根据用户级别和密码类型选择不同审批路径
- **完整测试**：从创建申请到审批完成的全流程测试

## 前置条件

- Python 3.8+
- Django 已安装
- SpiffWorkflow 已安装
- 数据库已初始化

## 第一步：环境准备

### 1.1 启动 Django 服务

在项目根目录下执行：

```bash
# Windows PowerShell
cd leave_system
python manage.py runserver 0.0.0.0:8000

# 或者使用完整路径
cd "E:\project\leave_system-main\leave_system"
python manage.py runserver 0.0.0.0:8000
```

### 1.2 验证服务运行

打开浏览器访问：`http://localhost:8000/api/`

如果看到 JSON 响应，说明服务正常运行：
```json
{
  "message": "欢迎使用请假审批系统 API",
  "version": "2.0",
  "endpoints": {...}
}
```

## 第二步：创建密码修改流程模型

### 2.1 创建流程目录结构

```bash
cd process_models
mkdir -p password/password-change
```

### 2.2 创建流程组配置文件

创建文件：`process_models/password/process_group.json`

```json
{
  "id": "password",
  "display_name": "密码管理流程组",
  "description": "密码修改、重置等相关审批流程"
}
```

### 2.3 创建流程模型配置文件

创建文件：`process_models/password/password-change/process_model.json`

```json
{
  "id": "password-change",
  "display_name": "密码修改审批流程",
  "description": "支持多级审批和多分支的密码修改审批流程",
  "primary_file_name": "password-change.bpmn",
  "primary_process_id": "Process_PasswordChange"
}
```

## 第三步：创建 BPMN 流程文件

### 3.1 创建密码修改审批流程

创建文件：`process_models/password/password-change/password-change.bpmn`

这个流程包含：
- **开始节点**：流程启动
- **申请表单**：填写密码修改申请
- **路由网关**：根据用户级别和密码类型分支
  - 普通用户 + 普通密码 → 部门主管审批
  - 普通用户 + 重要密码 → 部门主管 → IT安全主管
  - 管理员用户 → 部门主管 → IT安全主管 → 系统管理员
- **审批任务**：各级审批人审批
- **结束节点**：批准或拒绝


## 第四步：创建表单 Schema 文件

### 4.1 创建申请表单 Schema

创建文件：`process_models/password/password-change/password-form-schema.json`

```json
{
  "title": "密码修改申请表",
  "description": "请填写密码修改申请信息",
  "type": "object",
  "required": ["user_email", "user_name", "department", "password_type", "user_level", "reason"],
  "properties": {
    "user_email": {
      "type": "string",
      "title": "申请人邮箱",
      "format": "email"
    },
    "user_name": {
      "type": "string",
      "title": "申请人姓名"
    },
    "department": {
      "type": "string",
      "title": "所属部门"
    },
    "password_type": {
      "type": "string",
      "title": "密码类型",
      "enum": ["normal", "important", "critical"],
      "enumNames": ["普通密码", "重要密码", "关键密码"]
    },
    "user_level": {
      "type": "string",
      "title": "用户级别",
      "enum": ["normal", "admin", "super_admin"],
      "enumNames": ["普通用户", "管理员", "超级管理员"]
    },
    "system_name": {
      "type": "string",
      "title": "系统名称"
    },
    "reason": {
      "type": "string",
      "title": "修改原因"
    }
  }
}
```

### 4.2 创建审批表单 Schema

创建文件：`process_models/password/password-change/approval-form-schema.json`

```json
{
  "title": "审批表单",
  "description": "请审批密码修改申请",
  "type": "object",
  "required": ["action", "comment"],
  "properties": {
    "action": {
      "type": "string",
      "title": "审批决策",
      "enum": ["approve", "reject"],
      "enumNames": ["批准", "拒绝"]
    },
    "comment": {
      "type": "string",
      "title": "审批意见"
    }
  }
}
```


## 第五步：创建完整的 BPMN 流程定义

由于 BPMN 文件较大，我们将分步创建。创建文件：`process_models/password/password-change/password-change.bpmn`

这个文件包含完整的 BPMN 2.0 XML 定义，包括：
- 流程节点（开始、任务、网关、结束）
- 流程连线
- 条件表达式
- 脚本任务

**注意**：BPMN 文件已经在项目中创建好了，你可以参考 `process_models/admin/admin/admin.bpmn` 的结构。

## 第六步：扩展数据模型（支持密码修改申请）

### 6.1 修改 LeaveRequest 模型

我们需要扩展现有的 `LeaveRequest` 模型来支持密码修改申请。

编辑文件：`leave_system/leave_api/models.py`

在 `LeaveRequest` 模型中添加以下字段：

```python
# 密码修改相关字段
password_type = models.CharField(
    max_length=50,
    null=True,
    blank=True,
    choices=[
        ('normal', '普通密码'),
        ('important', '重要密码'),
        ('critical', '关键密码'),
    ],
    verbose_name='密码类型'
)

user_level = models.CharField(
    max_length=50,
    null=True,
    blank=True,
    choices=[
        ('normal', '普通用户'),
        ('admin', '管理员'),
        ('super_admin', '超级管理员'),
    ],
    verbose_name='用户级别'
)

system_name = models.CharField(
    max_length=200,
    null=True,
    blank=True,
    verbose_name='系统名称'
)

request_type = models.CharField(
    max_length=50,
    default='leave',
    choices=[
        ('leave', '请假申请'),
        ('password_change', '密码修改'),
    ],
    verbose_name='申请类型'
)
```

### 6.2 生成并执行数据库迁移

```bash
cd leave_system
python manage.py makemigrations
python manage.py migrate
```


## 第七步：创建测试脚本

### 7.1 创建完整测试脚本

创建文件：`test_password_change.py`

```python
"""
密码修改审批流程测试脚本
测试多级审批和多分支审批功能
"""

import requests
import json
import time

# API 基础 URL
BASE_URL = "http://localhost:8000/api"

def print_section(title):
    """打印分隔线"""
    print("\n" + "="*60)
    print(f"  {title}")
    print("="*60 + "\n")

def test_scenario_1():
    """
    场景1：普通用户修改普通密码
    审批路径：部门主管审批
    """
    print_section("场景1：普通用户修改普通密码")
    
    # 1. 创建密码修改申请
    print("步骤1：创建密码修改申请...")
    create_data = {
        "user_email": "user1@company.com",
        "staff_full_name": "张三",
        "staff_dept": "技术部",
        "reason": "定期更换邮箱密码",
        "leave_hours": 0,  # 密码修改不需要请假时长
        "request_type": "password_change",
        "password_type": "normal",
        "user_level": "normal",
        "system_name": "企业邮箱系统"
    }
    
    response = requests.post(f"{BASE_URL}/leave/create/", json=create_data)
    result = response.json()
    
    if result['success']:
        print(f"✓ 申请创建成功")
        print(f"  申请ID: {result['leave_request_id']}")
        print(f"  流程实例ID: {result['process_instance_id']}")
        print(f"  使用流程: {result['workflow_spec_name']}")
        request_id = result['leave_request_id']
    else:
        print(f"✗ 申请创建失败: {result.get('error')}")
        return
    
    time.sleep(1)
    
    # 2. 查询待审批任务
    print("\n步骤2：查询部门主管的待审批任务...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "manager@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        print(f"✓ 找到 {result['count']} 个待审批任务")
        task = result['tasks'][0]
        print(f"  任务ID: {task['id']}")
        print(f"  任务名称: {task['name']}")
        print(f"  申请人: {task['leave_request']['staff_full_name']}")
        task_id = task['id']
    else:
        print("✗ 未找到待审批任务")
        return
    
    time.sleep(1)
    
    # 3. 部门主管批准
    print("\n步骤3：部门主管批准申请...")
    approve_data = {
        "leave_request_id": request_id,
        "task_id": task_id,
        "approver_email": "manager@company.com",
        "approver_name": "李经理",
        "comment": "同意修改密码"
    }
    
    response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
    result = response.json()
    
    if result['success']:
        print(f"✓ 审批成功")
        print(f"  当前状态: {result['status']}")
        print(f"  流程完成: {'是' if result['completed'] else '否'}")
    else:
        print(f"✗ 审批失败: {result.get('error')}")
    
    time.sleep(1)
    
    # 4. 查询审批历史
    print("\n步骤4：查询审批历史...")
    response = requests.get(f"{BASE_URL}/leave/requests/{request_id}/history/")
    result = response.json()
    
    if result['success']:
        print(f"✓ 审批历史记录：")
        for record in result['history']:
            print(f"  - {record['action_display']}: {record['operator_name']} ({record['created_at']})")
            if record['comment']:
                print(f"    意见: {record['comment']}")
    
    print("\n✓ 场景1测试完成！")

def test_scenario_2():
    """
    场景2：普通用户修改重要密码
    审批路径：部门主管 → IT安全主管
    """
    print_section("场景2：普通用户修改重要密码")
    
    # 1. 创建密码修改申请
    print("步骤1：创建密码修改申请...")
    create_data = {
        "user_email": "user2@company.com",
        "staff_full_name": "李四",
        "staff_dept": "财务部",
        "reason": "数据库密码泄露，需要紧急更换",
        "leave_hours": 0,
        "request_type": "password_change",
        "password_type": "important",
        "user_level": "normal",
        "system_name": "财务数据库系统"
    }
    
    response = requests.post(f"{BASE_URL}/leave/create/", json=create_data)
    result = response.json()
    
    if result['success']:
        print(f"✓ 申请创建成功")
        print(f"  申请ID: {result['leave_request_id']}")
        request_id = result['leave_request_id']
    else:
        print(f"✗ 申请创建失败: {result.get('error')}")
        return
    
    time.sleep(1)
    
    # 2. 部门主管审批
    print("\n步骤2：部门主管审批...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "finance_manager@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        print(f"✓ 找到待审批任务: {task_id}")
        
        approve_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "finance_manager@company.com",
            "approver_name": "王经理",
            "comment": "情况属实，同意修改"
        }
        
        response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
        result = response.json()
        
        if result['success']:
            print(f"✓ 部门主管审批通过")
        else:
            print(f"✗ 审批失败: {result.get('error')}")
            return
    else:
        print("✗ 未找到待审批任务")
        return
    
    time.sleep(1)
    
    # 3. IT安全主管审批
    print("\n步骤3：IT安全主管审批...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "it_security@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        print(f"✓ 找到待审批任务: {task_id}")
        
        approve_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "it_security@company.com",
            "approver_name": "赵主管",
            "comment": "已确认安全风险，批准修改"
        }
        
        response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
        result = response.json()
        
        if result['success']:
            print(f"✓ IT安全主管审批通过")
            print(f"  流程完成: {'是' if result['completed'] else '否'}")
        else:
            print(f"✗ 审批失败: {result.get('error')}")
    else:
        print("✗ 未找到待审批任务")
    
    print("\n✓ 场景2测试完成！")


def test_scenario_3():
    """
    场景3：管理员修改关键密码
    审批路径：部门主管 → IT安全主管 → 系统管理员
    """
    print_section("场景3：管理员修改关键密码")
    
    # 1. 创建密码修改申请
    print("步骤1：创建密码修改申请...")
    create_data = {
        "user_email": "admin@company.com",
        "staff_full_name": "王五",
        "staff_dept": "IT部",
        "reason": "系统升级需要更换root密码",
        "leave_hours": 0,
        "request_type": "password_change",
        "password_type": "critical",
        "user_level": "admin",
        "system_name": "生产服务器"
    }
    
    response = requests.post(f"{BASE_URL}/leave/create/", json=create_data)
    result = response.json()
    
    if result['success']:
        print(f"✓ 申请创建成功")
        print(f"  申请ID: {result['leave_request_id']}")
        request_id = result['leave_request_id']
    else:
        print(f"✗ 申请创建失败: {result.get('error')}")
        return
    
    time.sleep(1)
    
    # 2. 部门主管审批
    print("\n步骤2：部门主管审批...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "it_manager@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        approve_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "it_manager@company.com",
            "approver_name": "刘经理",
            "comment": "系统升级需要，同意"
        }
        
        response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
        if response.json()['success']:
            print(f"✓ 部门主管审批通过")
    
    time.sleep(1)
    
    # 3. IT安全主管审批
    print("\n步骤3：IT安全主管审批...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "it_security@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        approve_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "it_security@company.com",
            "approver_name": "赵主管",
            "comment": "已评估安全风险，同意"
        }
        
        response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
        if response.json()['success']:
            print(f"✓ IT安全主管审批通过")
    
    time.sleep(1)
    
    # 4. 系统管理员审批
    print("\n步骤4：系统管理员审批...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "sysadmin@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        approve_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "sysadmin@company.com",
            "approver_name": "孙管理员",
            "comment": "最终批准，可以执行密码修改"
        }
        
        response = requests.post(f"{BASE_URL}/leave/approve/", json=approve_data)
        result = response.json()
        
        if result['success']:
            print(f"✓ 系统管理员审批通过")
            print(f"  流程完成: {'是' if result['completed'] else '否'}")
    
    print("\n✓ 场景3测试完成！")

def test_scenario_4():
    """
    场景4：拒绝场景
    测试审批拒绝功能
    """
    print_section("场景4：审批拒绝场景")
    
    # 1. 创建申请
    print("步骤1：创建密码修改申请...")
    create_data = {
        "user_email": "user3@company.com",
        "staff_full_name": "赵六",
        "staff_dept": "市场部",
        "reason": "忘记密码",
        "leave_hours": 0,
        "request_type": "password_change",
        "password_type": "normal",
        "user_level": "normal",
        "system_name": "CRM系统"
    }
    
    response = requests.post(f"{BASE_URL}/leave/create/", json=create_data)
    result = response.json()
    
    if result['success']:
        print(f"✓ 申请创建成功")
        request_id = result['leave_request_id']
    else:
        print(f"✗ 申请创建失败")
        return
    
    time.sleep(1)
    
    # 2. 部门主管拒绝
    print("\n步骤2：部门主管拒绝申请...")
    response = requests.get(
        f"{BASE_URL}/leave/pending-approvals/",
        params={"user_email": "market_manager@company.com"}
    )
    result = response.json()
    
    if result['success'] and result['count'] > 0:
        task_id = result['tasks'][0]['id']
        reject_data = {
            "leave_request_id": request_id,
            "task_id": task_id,
            "approver_email": "market_manager@company.com",
            "approver_name": "周经理",
            "comment": "请先尝试密码找回功能，不需要修改密码"
        }
        
        response = requests.post(f"{BASE_URL}/leave/reject/", json=reject_data)
        result = response.json()
        
        if result['success']:
            print(f"✓ 申请已被拒绝")
            print(f"  最终状态: {result['status']}")
    
    print("\n✓ 场景4测试完成！")

if __name__ == "__main__":
    print("\n" + "="*60)
    print("  密码修改审批流程测试")
    print("="*60)
    
    try:
        # 测试场景1：普通用户 + 普通密码
        test_scenario_1()
        time.sleep(2)
        
        # 测试场景2：普通用户 + 重要密码
        test_scenario_2()
        time.sleep(2)
        
        # 测试场景3：管理员 + 关键密码
        test_scenario_3()
        time.sleep(2)
        
        # 测试场景4：拒绝场景
        test_scenario_4()
        
        print_section("所有测试完成！")
        
    except Exception as e:
        print(f"\n✗ 测试过程中出现错误: {str(e)}")
        import traceback
        traceback.print_exc()
```


## 第八步：执行测试

### 8.1 确保 Django 服务运行

```bash
cd leave_system
python manage.py runserver 0.0.0.0:8000
```

### 8.2 运行测试脚本

打开新的终端窗口：

```bash
python test_password_change.py
```

### 8.3 预期输出

测试脚本会依次执行4个场景：

**场景1：普通用户修改普通密码**
- 创建申请 → 部门主管审批 → 完成

**场景2：普通用户修改重要密码**
- 创建申请 → 部门主管审批 → IT安全主管审批 → 完成

**场景3：管理员修改关键密码**
- 创建申请 → 部门主管审批 → IT安全主管审批 → 系统管理员审批 → 完成

**场景4：拒绝场景**
- 创建申请 → 部门主管拒绝 → 完成

## 第九步：验证结果

### 9.1 查看数据库记录

```bash
cd leave_system
python manage.py shell
```

在 Python shell 中执行：

```python
from leave_api.models import LeaveRequest, ApprovalHistory

# 查看所有密码修改申请
requests = LeaveRequest.objects.filter(request_type='password_change')
for req in requests:
    print(f"申请ID: {req.id}, 状态: {req.status}, 申请人: {req.staff_full_name}")

# 查看某个申请的审批历史
request_id = 1  # 替换为实际的申请ID
history = ApprovalHistory.objects.filter(leave_request_id=request_id)
for h in history:
    print(f"{h.action_display}: {h.operator_name} - {h.comment}")
```

### 9.2 使用 API 查询

```bash
# 查询我的申请
curl "http://localhost:8000/api/leave/my-requests/?user_email=user1@company.com"

# 查询待审批任务
curl "http://localhost:8000/api/leave/pending-approvals/?user_email=manager@company.com"

# 查询审批历史
curl "http://localhost:8000/api/leave/requests/1/history/"
```


## 第十步：自定义和扩展

### 10.1 修改审批路径

如果需要修改审批路径，编辑 BPMN 文件中的条件表达式：

```xml
<!-- 示例：修改路由条件 -->
<bpmn:sequenceFlow id="Flow_Normal" name="普通密码" sourceRef="Gateway_Route" targetRef="Task_Manager">
  <bpmn:conditionExpression>password_type == "normal" and user_level == "normal"</bpmn:conditionExpression>
</bpmn:sequenceFlow>
```

### 10.2 添加新的审批节点

在 BPMN 文件中添加新的 `userTask` 节点：

```xml
<bpmn:userTask id="Task_NewApprover" name="新审批人">
  <bpmn:extensionElements>
    <spiffworkflow:properties>
      <spiffworkflow:property name="formJsonSchemaFilename" value="approval-form-schema.json" />
    </spiffworkflow:properties>
  </bpmn:extensionElements>
  <bpmn:incoming>Flow_In</bpmn:incoming>
  <bpmn:outgoing>Flow_Out</bpmn:outgoing>
</bpmn:userTask>
```

### 10.3 添加超时提醒

在审批任务上添加边界事件：

```xml
<bpmn:boundaryEvent id="Boundary_Timeout" name="超时提醒" attachedToRef="Task_Manager" cancelActivity="false">
  <bpmn:outgoing>Flow_Timeout</bpmn:outgoing>
  <bpmn:timerEventDefinition>
    <bpmn:timeDuration>PT24H</bpmn:timeDuration>
  </bpmn:timerEventDefinition>
</bpmn:boundaryEvent>
```

### 10.4 配置审批规则

使用审批规则 API 动态配置流程选择：

```python
import requests

# 创建审批规则
rule_data = {
    "name": "密码修改规则",
    "description": "根据密码类型和用户级别选择流程",
    "priority": 10,
    "is_active": True,
    "password_type": "critical",
    "user_level": "admin",
    "workflow_spec_name": "password-change"
}

response = requests.post("http://localhost:8000/api/approval-rules/", json=rule_data)
print(response.json())
```

## 第十一步：常见问题排查

### 11.1 流程启动失败

**问题**：创建申请时返回错误

**排查步骤**：
1. 检查 BPMN 文件是否存在：`process_models/password/password-change/password-change.bpmn`
2. 检查流程模型配置：`process_models/password/password-change/process_model.json`
3. 查看 Django 日志：`python manage.py runserver` 的输出

**解决方案**：
```bash
# 验证 BPMN 文件
python -c "from lxml import etree; etree.parse('process_models/password/password-change/password-change.bpmn')"
```

### 11.2 找不到待审批任务

**问题**：查询待审批任务返回空列表

**排查步骤**：
1. 检查申请状态是否为 `pending`
2. 检查工作流状态是否正确保存
3. 检查审批人邮箱是否匹配

**解决方案**：
```python
# 在 Django shell 中检查
from leave_api.models import LeaveRequest
req = LeaveRequest.objects.get(id=1)
print(f"状态: {req.status}")
print(f"工作流状态: {req.workflow_state is not None}")
```

### 11.3 审批后流程未继续

**问题**：审批后没有进入下一个节点

**排查步骤**：
1. 检查条件表达式是否正确
2. 检查任务数据是否包含必要字段（如 `action`）
3. 查看 SpiffWorkflow 日志

**解决方案**：
```python
# 检查工作流数据
from leave_api.spiff_client_v2 import spiff_client
workflow = spiff_client.deserialize_workflow(req.workflow_state, req.workflow_spec_name)
print(f"工作流数据: {workflow.data}")
print(f"就绪任务: {[t.task_spec.name for t in workflow.get_ready_user_tasks()]}")
```


## 第十二步：高级功能

### 12.1 代理审批

设置审批代理人：

```python
import requests
from datetime import datetime, timedelta

# 创建代理设置
proxy_data = {
    "principal_email": "manager@company.com",
    "proxy_email": "deputy@company.com",
    "start_date": datetime.now().isoformat(),
    "end_date": (datetime.now() + timedelta(days=7)).isoformat(),
    "is_active": True
}

response = requests.post("http://localhost:8000/api/proxy-settings/", json=proxy_data)
print(response.json())
```

### 12.2 抄送功能

为申请添加抄送人：

```python
import requests

# 添加抄送
cc_data = {
    "cc_to_email": "observer@company.com",
    "cc_by_email": "user1@company.com"
}

response = requests.post(
    "http://localhost:8000/api/leave/requests/1/cc/",
    json=cc_data
)
print(response.json())
```

### 12.3 催办功能

催办审批任务：

```python
import requests

# 催办任务
urge_data = {
    "urge_by_email": "user1@company.com",
    "urge_by_name": "张三",
    "message": "请尽快审批，比较紧急"
}

response = requests.post(
    "http://localhost:8000/api/leave/requests/1/urge/",
    json=urge_data
)
print(response.json())
```

### 12.4 审批轨迹可视化

获取审批轨迹数据：

```python
import requests

response = requests.get("http://localhost:8000/api/leave/requests/1/timeline/")
result = response.json()

if result['success']:
    for item in result['timeline']:
        print(f"{item['timestamp']}: {item['action_display']} - {item['operator']['name']}")
        if item['comment']:
            print(f"  意见: {item['comment']}")
```

## 总结

通过本教程，你已经完成了：

1. ✅ 创建了密码修改审批流程的 BPMN 定义
2. ✅ 配置了多级审批路径（部门主管 → IT安全主管 → 系统管理员）
3. ✅ 实现了多分支审批（根据密码类型和用户级别）
4. ✅ 扩展了数据模型支持密码修改申请
5. ✅ 创建了完整的测试脚本
6. ✅ 验证了所有审批场景

## 下一步

- 集成前端界面展示审批流程
- 添加邮件通知功能
- 配置 Celery 实现异步任务处理
- 添加更多业务规则和验证
- 实现审批流程的可视化设计器

## 参考资料

- SpiffWorkflow 文档：https://spiffworkflow.readthedocs.io/
- BPMN 2.0 规范：https://www.omg.org/spec/BPMN/2.0/
- Django REST Framework：https://www.django-rest-framework.org/

---

**注意事项**：
- 本教程使用的是开发环境配置，生产环境需要额外的安全配置
- 建议使用 PostgreSQL 或 MySQL 替代 SQLite
- 需要配置 Redis 和 Celery 实现完整的异步功能
- 密码修改操作需要额外的安全验证和审计日志
