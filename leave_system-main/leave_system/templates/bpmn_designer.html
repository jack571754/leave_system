<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPMN ÊµÅÁ®ãËÆæËÆ°Âô®</title>
    
    <!-- bpmn-js Ê†∏ÂøÉÂ∫ì -->
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.11.1/dist/assets/diagram-js.css">
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.11.1/dist/assets/bpmn-js.css">
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.11.1/dist/assets/bpmn-font/css/bpmn-embedded.css">
    <script src="https://unpkg.com/bpmn-js@17.11.1/dist/bpmn-modeler.development.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,255,255,0.3);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }
        
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
        }
        
        .sidebar-section {
            padding: 20px;
        }
        
        .sidebar h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .process-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .process-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }
        
        .process-item.active {
            background: #e7e9fc;
            border-color: #667eea;
        }
        
        .add-btn {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .add-btn:hover {
            background: #5568d3;
        }
        
        .icon-btn {
            padding: 4px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .icon-btn:hover {
            background: #e0e0e0;
        }
        
        .icon-btn.delete:hover {
            background: #fee;
            color: #f44;
        }
        
        .empty-list {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
            background: white;
        }
        
        #canvas {
            width: 100%;
            height: 100%;
        }
        
        .properties-panel {
            width: 400px;
            background: white;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }
        
        .properties-panel.show {
            display: block;
        }
        
        .properties-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .properties-header h2 {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .properties-header .element-type {
            font-size: 12px;
            color: #999;
        }
        
        .property-group {
            margin-bottom: 20px;
        }
        
        .property-group h3 {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .property-item {
            margin-bottom: 12px;
        }
        
        .property-label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .property-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .property-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .property-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            min-height: 100px;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.5;
        }
        
        .property-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 18px;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        
        .xml-viewer {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® BPMN ÊµÅÁ®ãËÆæËÆ°Âô®</h1>
        <div class="header-actions">
            <button class="btn btn-success" onclick="saveDiagram()">üíæ ‰øùÂ≠ò</button>
            <button class="btn btn-primary" onclick="viewXML()">üëÅÔ∏è Êü•ÁúãXML</button>
            <button class="btn btn-secondary" onclick="window.location.href='/dashboard/'">üè† ËøîÂõû</button>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-section">
                <h3>
                    ÂéÜÂè≤ÊµÅÁ®ã
                    <button class="add-btn" onclick="createNewProcess()">+ Êñ∞Âª∫</button>
                </h3>
                <div id="process-list">
                    <div class="empty-list">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>
        </div>
        
        <div class="canvas-container">
            <div id="canvas"></div>
        </div>
        
        <div class="properties-panel" id="properties-panel"></div>
    </div>
    
    <div class="modal" id="xmlModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Êü•Áúã XML</h2>
                <button class="modal-close" onclick="closeXMLModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="xml-viewer" id="xmlContent"></div>
            </div>
        </div>
    </div>
    
    <script>
        let modeler = null;
        let currentProcessId = null;
        let processList = [];
        const SPIFF_NS = 'http://spiffworkflow.org/bpmn/schema/1.0/core';

        const defaultDiagram = `<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" 
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" 
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  xmlns:spiffworkflow="${SPIFF_NS}"
                  id="Definitions_1" 
                  targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="Process_1" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1" name="ÂºÄÂßã">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:task id="Task_1" name="‰ªªÂä°">
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
    </bpmn:task>
    <bpmn:endEvent id="EndEvent_1" name="ÁªìÊùü">
      <bpmn:incoming>Flow_2</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_1_di" bpmnElement="Task_1">
        <dc:Bounds x="240" y="80" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">
        <dc:Bounds x="392" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">
        <di:waypoint x="188" y="120" />
        <di:waypoint x="240" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">
        <di:waypoint x="340" y="120" />
        <di:waypoint x="392" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>`;

        function initBpmnModeler() {
            if (!window.BpmnJS) {
                console.error('bpmn-js Â∫ìÊú™Âä†ËΩΩ');
                alert('bpmn-js Â∫ìÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÂà∑Êñ∞È°µÈù¢');
                return;
            }

            modeler = new BpmnJS({
                container: '#canvas',
                keyboard: {
                    bindTo: document
                }
            });

            const eventBus = modeler.get('eventBus');
            
            eventBus.on('selection.changed', (e) => {
                const element = e.newSelection[0];
                if (element) {
                    showProperties(element);
                } else {
                    hideProperties();
                }
            });

            loadProcessList();
        }

        function getSpiffProperties(element) {
            const bo = element.businessObject;
            const extensionElements = bo.extensionElements;
            const properties = {};
            
            if (extensionElements) {
                const spiffProps = extensionElements.values.find(e => 
                    e.$type === 'spiffworkflow:properties'
                );
                
                if (spiffProps && spiffProps.properties) {
                    spiffProps.properties.forEach(prop => {
                        properties[prop.name] = prop.value;
                    });
                }
                
                const preScript = extensionElements.values.find(e => 
                    e.$type === 'spiffworkflow:preScript'
                );
                if (preScript) {
                    properties.preScript = preScript.value || preScript.$body || '';
                }
                
                const postScript = extensionElements.values.find(e => 
                    e.$type === 'spiffworkflow:postScript'
                );
                if (postScript) {
                    properties.postScript = postScript.value || postScript.$body || '';
                }
            }
            
            return properties;
        }

        function showProperties(element) {
            const panel = document.getElementById('properties-panel');
            panel.classList.add('show');
            
            const elementType = element.type || 'Unknown';
            const elementName = element.businessObject.name || '';
            const elementId = element.id;
            const spiffProps = getSpiffProperties(element);
            
            let html = `
                <div class="properties-header">
                    <h2>${elementName || elementId}</h2>
                    <div class="element-type">${elementType}</div>
                </div>
                
                <div class="property-group">
                    <h3>Âü∫Êú¨Â±ûÊÄß</h3>
                    <div class="property-item">
                        <label class="property-label">ID</label>
                        <input type="text" class="property-input" value="${elementId}" readonly>
                    </div>
                    <div class="property-item">
                        <label class="property-label">ÂêçÁß∞</label>
                        <input type="text" class="property-input" value="${elementName}" 
                               onchange="updateElementProperty('${elementId}', 'name', this.value)">
                    </div>
                    <div class="property-item">
                        <label class="property-label">Á±ªÂûã</label>
                        <input type="text" class="property-input" value="${elementType}" readonly>
                    </div>
                </div>
            `;
            
            // SpiffWorkflow ÁâπÂÆöÂ±ûÊÄß
            if (elementType.includes('Task')) {
                html += `
                    <div class="property-group">
                        <h3>SpiffWorkflow Â±ûÊÄß</h3>
                        <div class="property-item">
                            <label class="property-label">Ë°®Âçï Schema Êñá‰ª∂</label>
                            <input type="text" class="property-input" 
                                   value="${spiffProps.formSchema || ''}"
                                   onchange="updateSpiffProperty('${elementId}', 'formSchema', this.value)"
                                   placeholder="‰æãÂ¶Ç: approval-form-schema.json">
                        </div>
                        <div class="property-item">
                            <label class="property-label">‰ªªÂä°ÂàÜÈÖç‰∫∫</label>
                            <input type="text" class="property-input" 
                                   value="${spiffProps.assignee || ''}"
                                   onchange="updateSpiffProperty('${elementId}', 'assignee', this.value)"
                                   placeholder="‰æãÂ¶Ç: dept_manager">
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h3>ÂâçÁΩÆËÑöÊú¨ (Python)</h3>
                        <div class="property-item">
                            <label class="property-label">Âú®‰ªªÂä°ÊâßË°åÂâçËøêË°å</label>
                            <textarea class="property-textarea" 
                                      onchange="updateSpiffScript('${elementId}', 'preScript', this.value)"
                                      placeholder="# Python ‰ª£Á†Å\n# ‰æãÂ¶Ç: assignee = get_manager(dept)">${spiffProps.preScript || ''}</textarea>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h3>ÂêéÁΩÆËÑöÊú¨ (Python)</h3>
                        <div class="property-item">
                            <label class="property-label">Âú®‰ªªÂä°ÂÆåÊàêÂêéËøêË°å</label>
                            <textarea class="property-textarea" 
                                      onchange="updateSpiffScript('${elementId}', 'postScript', this.value)"
                                      placeholder="# Python ‰ª£Á†Å\n# ‰æãÂ¶Ç: update_status(request_id, 'approved')">${spiffProps.postScript || ''}</textarea>
                        </div>
                    </div>
                `;
            }
            
            // ÁΩëÂÖ≥Êù°‰ª∂Ë°®ËææÂºè
            if (elementType.includes('SequenceFlow')) {
                const conditionExpression = element.businessObject.conditionExpression;
                const condition = conditionExpression ? conditionExpression.body : '';
                
                html += `
                    <div class="property-group">
                        <h3>ÊµÅËΩ¨Êù°‰ª∂</h3>
                        <div class="property-item">
                            <label class="property-label">Êù°‰ª∂Ë°®ËææÂºè (Python)</label>
                            <textarea class="property-textarea" 
                                      onchange="updateConditionExpression('${elementId}', this.value)"
                                      placeholder="# Python Ë°®ËææÂºè\n# ‰æãÂ¶Ç: leave_hours >= 24">${condition}</textarea>
                        </div>
                    </div>
                `;
            }
            
            panel.innerHTML = html;
        }

        function hideProperties() {
            const panel = document.getElementById('properties-panel');
            panel.classList.remove('show');
        }

        function updateElementProperty(elementId, property, value) {
            const modeling = modeler.get('modeling');
            const elementRegistry = modeler.get('elementRegistry');
            const element = elementRegistry.get(elementId);
            
            if (element) {
                modeling.updateProperties(element, {
                    [property]: value
                });
            }
        }

        function updateSpiffProperty(elementId, propertyName, value) {
            const modeling = modeler.get('modeling');
            const elementRegistry = modeler.get('elementRegistry');
            const bpmnFactory = modeler.get('bpmnFactory');
            const element = elementRegistry.get(elementId);
            
            if (!element) return;
            
            const bo = element.businessObject;
            let extensionElements = bo.extensionElements;
            
            if (!extensionElements) {
                extensionElements = bpmnFactory.create('bpmn:ExtensionElements');
            }
            
            let spiffProps = extensionElements.values?.find(e => 
                e.$type === 'spiffworkflow:properties'
            );
            
            if (!spiffProps) {
                spiffProps = bpmnFactory.create('spiffworkflow:properties', {
                    properties: []
                });
                extensionElements.values = extensionElements.values || [];
                extensionElements.values.push(spiffProps);
            }
            
            let prop = spiffProps.properties?.find(p => p.name === propertyName);
            
            if (!prop) {
                prop = bpmnFactory.create('spiffworkflow:property', {
                    name: propertyName,
                    value: value
                });
                spiffProps.properties = spiffProps.properties || [];
                spiffProps.properties.push(prop);
            } else {
                prop.value = value;
            }
            
            modeling.updateProperties(element, {
                extensionElements: extensionElements
            });
        }

        function updateSpiffScript(elementId, scriptType, value) {
            const modeling = modeler.get('modeling');
            const elementRegistry = modeler.get('elementRegistry');
            const bpmnFactory = modeler.get('bpmnFactory');
            const element = elementRegistry.get(elementId);
            
            if (!element) return;
            
            const bo = element.businessObject;
            let extensionElements = bo.extensionElements;
            
            if (!extensionElements) {
                extensionElements = bpmnFactory.create('bpmn:ExtensionElements');
            }
            
            const existingScript = extensionElements.values?.find(e => 
                e.$type === `spiffworkflow:${scriptType}`
            );
            
            if (existingScript) {
                extensionElements.values = extensionElements.values.filter(e => 
                    e.$type !== `spiffworkflow:${scriptType}`
                );
            }
            
            if (value.trim()) {
                const script = bpmnFactory.create(`spiffworkflow:${scriptType}`);
                script.$body = value;
                extensionElements.values = extensionElements.values || [];
                extensionElements.values.push(script);
            }
            
            modeling.updateProperties(element, {
                extensionElements: extensionElements
            });
        }

        function updateConditionExpression(elementId, value) {
            const modeling = modeler.get('modeling');
            const elementRegistry = modeler.get('elementRegistry');
            const bpmnFactory = modeler.get('bpmnFactory');
            const element = elementRegistry.get(elementId);
            
            if (!element) return;
            
            let conditionExpression = null;
            
            if (value.trim()) {
                conditionExpression = bpmnFactory.create('bpmn:FormalExpression', {
                    body: value
                });
            }
            
            modeling.updateProperties(element, {
                conditionExpression: conditionExpression
            });
        }

        async function loadProcessList() {
            try {
                const response = await fetch('/api/bpmn/processes/');
                const data = await response.json();
                processList = data.processes || [];
                renderProcessList();
                
                if (processList.length > 0) {
                    loadProcess(processList[0].id);
                } else {
                    await modeler.importXML(defaultDiagram);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊµÅÁ®ãÂàóË°®Â§±Ë¥•:', error);
                document.getElementById('process-list').innerHTML = '<div class="empty-list">Âä†ËΩΩÂ§±Ë¥•</div>';
                await modeler.importXML(defaultDiagram);
            }
        }

        function renderProcessList() {
            const listEl = document.getElementById('process-list');
            if (processList.length === 0) {
                listEl.innerHTML = '<div class="empty-list">ÊöÇÊó†ÊµÅÁ®ã</div>';
                return;
            }
            
            listEl.innerHTML = processList.map(process => `
                <div class="process-item ${process.id === currentProcessId ? 'active' : ''}" onclick="loadProcess('${process.id}')">
                    <span class="process-name" title="${process.name}">${process.name}</span>
                    <div class="process-actions">
                        <button class="icon-btn delete" onclick="event.stopPropagation();deleteProcess('${process.id}')" title="Âà†Èô§">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function loadProcess(processId) {
            currentProcessId = processId;
            try {
                const response = await fetch(`/api/bpmn/processes/${processId}/`);
                const data = await response.json();
                
                if (data.xml) {
                    await modeler.importXML(data.xml);
                } else {
                    await modeler.importXML(defaultDiagram);
                }
                renderProcessList();
            } catch (error) {
                console.error('Âä†ËΩΩÊµÅÁ®ãÂ§±Ë¥•:', error);
                alert('Âä†ËΩΩÊµÅÁ®ãÂ§±Ë¥•: ' + error.message);
            }
        }

        async function saveDiagram() {
            try {
                const { xml } = await modeler.saveXML({ format: true });
                
                if (!currentProcessId) {
                    alert('ËØ∑ÂÖàÈÄâÊã©ÊàñÂàõÂª∫‰∏Ä‰∏™ÊµÅÁ®ã');
                    return;
                }
                
                const response = await fetch(`/api/bpmn/processes/${currentProcessId}/`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ xml })
                });
                
                const data = await response.json();
                alert('‰øùÂ≠òÊàêÂäüÔºÅ');
            } catch (error) {
                console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
                alert('‰øùÂ≠òÂ§±Ë¥•: ' + error.message);
            }
        }

        async function viewXML() {
            try {
                const { xml } = await modeler.saveXML({ format: true });
                document.getElementById('xmlContent').textContent = xml;
                document.getElementById('xmlModal').classList.add('show');
            } catch (error) {
                console.error('Êü•ÁúãXMLÂ§±Ë¥•:', error);
                alert('Êü•ÁúãXMLÂ§±Ë¥•: ' + error.message);
            }
        }
        
        function closeXMLModal() {
            document.getElementById('xmlModal').classList.remove('show');
        }

        async function deleteProcess(processId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊµÅÁ®ãÂêóÔºü')) return;
            
            try {
                await fetch(`/api/bpmn/processes/${processId}/`, {
                    method: 'DELETE'
                });
                alert('Âà†Èô§ÊàêÂäü');
                loadProcessList();
            } catch (error) {
                console.error('Âà†Èô§Â§±Ë¥•:', error);
                alert('Âà†Èô§Â§±Ë¥•: ' + error.message);
            }
        }

        async function createNewProcess() {
            const name = prompt('ËØ∑ËæìÂÖ•ÊµÅÁ®ãÂêçÁß∞:');
            if (!name) return;
            
            try {
                const { xml } = await modeler.saveXML({ format: true });
                
                const response = await fetch('/api/bpmn/processes/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        description: '',
                        group: 'custom',
                        xml: xml
                    })
                });
                
                await response.json();
                alert('ÂàõÂª∫ÊàêÂäü');
                loadProcessList();
            } catch (error) {
                console.error('ÂàõÂª∫Â§±Ë¥•:', error);
                alert('ÂàõÂª∫Â§±Ë¥•: ' + error.message);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            initBpmnModeler();
        });
    </script>
</body>
</html>
